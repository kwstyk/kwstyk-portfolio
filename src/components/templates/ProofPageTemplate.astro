---
// /src/components/templates/ProofPageTemplate.astro
import Layout        from '@/layouts/Layout.astro'
import ProofHero     from '@/components/organisms/ProofHero.astro'
import ProofMetaCard from '@/components/organisms/ProofMetaCard.astro'
import SectionNav    from '@/components/organisms/SectionNav.astro'

interface Props {
  children?: any;
  title:       string;
  description?: string;
  /** Structure ç”¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ä½¿ã†ã®ã§å—ã‘å–ã‚‹ */
  category?:    string;
  /** Proof ã®é€²æ—è¡¨ç¤ºã«ä½¿ã†ã®ã§å—ã‘å–ã‚‹ */
  progress:    number;
  difficulty?: 'easy' | 'medium' | 'hard' | 'expert';
  repro:       ('docker' | 'terraform' | 'vagrant' | 'manual')[];
  stack:       string[];
  updated:     string;
  /** ãƒãƒƒã‚¸ç”»åƒ URL */
  ci_status?:  string;
  tags?:       string[];
  /** é–¢é€£ Story ã¸ã®ãƒªãƒ³ã‚¯ä¸€è¦§ */
  stories?:    string[];
  /** why.md ã¸ã®ãƒ‘ã‚¹ */
  whyContent?: string;
  class?:      string;
}

const {
  title,
  description = '',
  category,
  progress,
  difficulty,
  repro,
  stack,
  updated,
  ci_status: ci_status,
  tags = [],
  stories = [],
  whyContent,
  class: className = '',
} = Astro.props as Props

---
<Layout pageTitle={`Proof | ${title}`} class={className}>
  <main class="px-4 lg:px-16 py-8 mx-auto max-w-screen-xl">
    <ProofHero
      title={title}
      description={description}
      difficulty={difficulty}
      repro={repro}
      stack={stack}
      ci_status={ci_status}
    />

    <!-- ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã«ã‚³ãƒ”ãƒ¼ç”¨ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã€ç›¸å¯¾é…ç½®ã‚’æŒ‡å®š -->
<article
  class="
    prose lg:prose-lg max-w-none mt-12 relative
    [&_h2]:border-b            /* å…¨ãƒ¢ãƒ¼ãƒ‰ã§ä¸‹ç·š */
    [&_h2]:pb-2 [&_h2]:mb-4     /* ä¸‹ç·šã¾ã‚ã‚Šã®ä½™ç™½ */
    [&_h2]:border-gray-200      /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ç·šè‰² */
    dark:[&_h2]:border-gray-600 /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç·šè‰² */
    dark:prose-invert           /* å¿…è¦ãªã‚‰æ–‡å­—è‰²ã‚‚åè»¢ */
    [&_code]:bg-gray-100 [&_code]:text-blue-600 [&_code]:px-1 [&_code]:py-[2px] [&_code]:rounded
    dark:[&_code]:bg-gray-700 dark:[&_code]:text-blue-400
  "
>
  <slot />
  <slot name="footer" />

  <!-- â”€â”€â”€ Why.md æŠ˜ã‚ŠãŸãŸã¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
{whyContent && (
  <details class="mt-8 rounded border border-slate-600 [&_summary]:cursor-pointer">
    <summary class="py-2 px-4 bg-slate-700/40 font-semibold">
      ğŸ§ Why â€” è¨­è¨ˆç†ç”±ã‚’é–‹ã
    </summary>
        <article
          class="prose prose-invert p-4 max-w-none lg:prose-lg"
          set:html={whyContent}
        />
  </details>
)}
  
  <!-- ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('article pre code').forEach(codeElem => {
        const pre = codeElem.parentElement;
        if (!pre || pre.querySelector('.copy-button')) return;
        pre.style.position = 'relative';
        const btn = document.createElement('button');
        btn.innerText = 'Copy';
        btn.className = 'copy-button absolute top-2 right-2 text-xs px-2 py-1 bg-gray-700 text-white rounded';
        btn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(codeElem.innerText.trim());
            btn.innerText = 'Copied!';
            setTimeout(() => (btn.innerText = 'Copy'), 2000);
          } catch {
            btn.innerText = 'Failed';
          }
        });
        pre.appendChild(btn);
      });
    });
  </script>
</article>

<ProofMetaCard updated={updated} tags={tags} class="mt-10" />
<SectionNav />
  </main>
</Layout>
