# ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ§‹æˆä»•æ§˜æ›¸ vâ€¯2.3Â â€” **Unified Architecture Spec**

æ›´æ–°æ—¥Â :Â 2025â€‘05â€‘12Â Â Â ä½œè€…Â :Â kwstykÂ /Â ChatGPTÂ (o3)

> **æœ¬æ›¸ã¯ vâ€¯2.2 ã‚’å…¨é¢æ”¹è¨‚**ã€‚Landingãƒ»Structureãƒ»Proofãƒ»Story ã®å„å®Œæˆä»•æ§˜æ›¸ (2025â€‘05â€‘12 æ™‚ç‚¹) ã¨
> ç«‹ä½“ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæˆ¦ç•¥Â vâ€¯7.1 ã‚’çµ±åˆã—ã€å®Ÿè£…è¦ç´„ãƒ»CIãƒ»é‹ç”¨ãƒ•ãƒ­ãƒ¼ã‚’ 1â€¯å†Šã«é›†ç´„ã—ãŸæœ€æ–°ç‰ˆã§ã™ã€‚

---

## 0. ã‚³ãƒ³ã‚»ãƒ—ãƒˆ & ãƒšãƒ«ã‚½ãƒŠæ·±åº¦ãƒãƒƒãƒ—

| ãƒšãƒ«ã‚½ãƒŠ           | ç›®çš„            | å¯¾å¿œãƒ¬ã‚¤ãƒ¤         | æƒ³å®šæ·±åº¦ |
| -------------- | ------------- | ------------- | ---- |
| **æ¡ç”¨æ‹…å½“**       | ã‚¹ã‚­ãƒ«ã®ä¿¯ç°ãƒ»ä¿å®ˆæ€§    | **Landing**   | 1    |
| **ç¾å ´ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢**    | å®Ÿè£…è©³ç´°ï¼CI & å†ç¾æ€§ | **Structure** | 2    |
| **å­¦ç¿’è€…ï¼ˆæœªæ¥ã®è‡ªåˆ†ï¼‰** | å†ç¾ãƒ©ãƒœï¼æ¤œè¨¼ãƒ­ã‚°     | **Proof**     | 3    |
| **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£**     | å¤±æ•—è«‡ï¼æ”¹å–„å²ï¼æŠ€è¡“è¨˜äº‹  | **Story**     | 4    |

> **æ·±åº¦ 0â€‘4**Â : æ•°å­—ãŒå¤§ãã„ã»ã©å†…éƒ¨äº‹æƒ…ã¸è¸ã¿è¾¼ã‚€éšå±¤ã€‚

---

## 1. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ & ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š

| ã‚«ãƒ†ã‚´ãƒª   | æ¡ç”¨æŠ€è¡“                                                                                       | Locked   |
| ------ | ------------------------------------------------------------------------------------------ | -------- |
| é™çš„ã‚µã‚¤ãƒˆ  | **AstroÂ 5.x**Â (`@astrojs/markdown-remark`)                                                 | `^5.7.3` |
| ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ | remarkâ€‘gfm / remarkâ€‘directive / rehypeâ€‘slug ã»ã‹                                             | latest   |
| UI/CSS | **TailwindÂ 3.4**Â (JIT, CSSÂ varsé€£æº)                                                         | `^3.4.1` |
| å‹ãƒ»Lint | TypeScriptâ€¯5.8 / ESLintâ€¯9 / Stylelintâ€¯15 / AstroÂ Check                                     | â€”        |
| ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° | GitHubÂ PagesÂ (prod) / VercelÂ (Preview)                                                     | â€”        |
| CI/CD  | GitHubÂ Actions (`ci.yml`,Â `deploy.yml`,Â `proof-ci.yml`,Â `nightly.yml`,Â `sync-stories.yml`) | â€”        |
| QAãƒ„ãƒ¼ãƒ«  | LighthouseÂ CI / Trivy / lychee / Vitest                                                    | latest   |
| Devç’°å¢ƒ  | devcontainer + Codespaces (`ubuntuâ€‘22.04`)                                                 | â€”        |

> **Lockfile**Â : `pnpm-lock.yaml` ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã€CI ã¯ `pnpm install --frozen-lockfile`ã€‚

---

## 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª & Atomic è¨­è¨ˆ

### 2.1 ãƒ«ãƒ¼ãƒˆæ§‹æˆï¼ˆvâ€¯2.3ï¼‰

```text
kwstyk-portfolio/
â”œâ”€ .github/workflows/
â”‚   â”œâ”€ ci.yml              # Lint / type-check / build
â”‚   â”œâ”€ proof-ci.yml        # Proof å†ç¾ & Trivy
â”‚   â”œâ”€ nightly.yml         # Lighthouse / deadâ€‘link / SBOM
â”‚   â””â”€ sync-stories.yml    # RSS â†’ stories.json (cron)
â”œâ”€ devcontainer.json / Dockerfile
â”œâ”€ plugins/               # â˜… remark / rehype è‡ªä½œãƒ—ãƒ©ã‚°ã‚¤ãƒ³
â”‚   â”œâ”€ remark-kwstyk-callout.js
â”‚   â”œâ”€ remark-include.js
â”‚   â””â”€ rehype-copy-button.js
â”œâ”€ scripts/
â”‚   â”œâ”€ mdx2md.ts          # æ—§ .mdx â†’ .md å¤‰æ›ãƒ˜ãƒ«ãƒ‘
â”‚   â””â”€ rss-to-json.ts     # Zenn/Note RSS åé›†
â”œâ”€ src/
â”‚   â”œâ”€ data/
â”‚   â”‚   â”œâ”€ categories.json          # Structure ã‚«ãƒ¼ãƒ‰å®šç¾©
â”‚   â”‚   â””â”€ stories.json             # Story ä¸€è¦§ (è‡ªå‹•ç”Ÿæˆ)
â”‚   â”œâ”€ content/proofs/**.md         # â˜… Proof ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ (pure MD)
â”‚   â”œâ”€ layouts/                     # å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â””â”€ Layout.astro            # siteName / pageTitle åˆ†é›¢æ¸ˆ
â”‚   â”œâ”€ pages/
â”‚   â”‚   â”œâ”€ index.astro               # Landing
â”‚   â”‚   â”œâ”€ structure/index.astro     # Structure ä¸€è¦§
â”‚   â”‚   â”œâ”€ structure/[slug].astro    # Structure è©³ç´° (å‹•çš„)
â”‚   â”‚   â”œâ”€ proof/index.astro         # â˜… Proof ä¸€è¦§ (æ–°è¦)
â”‚   â”‚   â”œâ”€ proof/[...slug].astro     # Proof è©³ç´° (å‹•çš„)
â”‚   â”‚   â””â”€ story/index.astro         # Story ä¸€è¦§
â”‚   â”œâ”€ components/ (Atomic)
â”‚   â”œâ”€ styles/ (globals.css, *.css)
â”‚   â””â”€ utils/  (seo.ts, schema/**)
â””â”€ docs/ strategy.mdÂ ã»ã‹
```

### 2.2 Atomic & Template ãƒ¬ã‚¤ãƒ¤

| éšå±¤           | ä»£è¡¨ãƒ•ã‚¡ã‚¤ãƒ«                                                                            | ä¸»è²¬å‹™          |
| ------------ | --------------------------------------------------------------------------------- | ------------ |
| **Atom**     | `Button.astro`, `Badge.astro`, `Heading.astro`                                    | æœ€å° UI è¦ç´      |
| **Molecule** | `Card.astro`, `Navbar.astro`, `StackChip.astro`, `FilterBar.astro`                | è¤‡åˆ UI ãƒ–ãƒ­ãƒƒã‚¯   |
| **Organism** | `Hero.astro`, `ProofHero.astro`, `StoryCardGrid.astro`                            | ã‚»ã‚¯ã‚·ãƒ§ãƒ³å˜ä½      |
| **Template** | `LandingTemplate.astro`, `ProofPageTemplate.astro`, `StructurePageTemplate.astro` | ãƒšãƒ¼ã‚¸éª¨æ ¼        |
| **Page**     | `/pages/**`                                                                       | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° & SEO |

> **å‘½åè¦å‰‡**Â : `PascalCase.astro`ã€‚Tailwind ç›´æ›¸ãå„ªå…ˆã€è¤‡é›‘åŒ–æ™‚ã®ã¿ `.module.css`ã€‚

---

## 3. ã‚¹ã‚¿ã‚¤ãƒ« & ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³

1. `globals.css` ã§ **CSSÂ Variables** å®šç¾©ã€‚
2. `tailwind.config.mjs` â†’ `theme.extend.colors` ã«åŒå¤‰æ•°ã‚’ãƒã‚¤ãƒ³ãƒ‰ã€‚
3. å‚ç…§é †ã¯ **Tailwind Class â†’ CSS Var â†’ ç›´å€¤**ã€‚JS å´ã‹ã‚‰ç›´æ¥ HEX ã‚’å‘¼ã°ãªã„ã€‚
4. Media Query ã¯ Tailwind ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆæ¨å¥¨ã€ç›´æ›¸ãã¯ `@media (max-width:â€¯640px)` é™å®šã€‚

### 3.1 ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ (å…±é€š)

| Token      | HEX       |
| ---------- | --------- |
| `bg-start` | `#0d1b2a` |
| `bg-mid`   | `#162d46` |
| `bg-end`   | `#0a2540` |
| `text`     | `#e0e7ff` |
| `accent`   | `#61dafb` |
| `card-bg`  | `#112240` |
| `border`   | `#233554` |

*ã‚«ãƒ†ã‚´ãƒªè‰²*Â : `categories.json.color` ã‚’ãã®ã¾ã¾ `border` & `text` ã«ä½¿ç”¨ã—ã€Tailwind safelist ã§ `bg-[hex]` ã‚’è¨±å¯ã€‚

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 4.1 categories.json (Structure)

```jsonc
[
  {
    "id": "network-security",
    "slug": "network-security",
    "title": "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£",
    "description": "å®‰å…¨ãªé€šä¿¡ã¨ç›£è¦–ä½“åˆ¶ã‚’ç¢ºç«‹ã™ã‚‹ãŸã‚ã®å®Ÿè·µ",
    "icon": "ğŸ›¡ï¸",
    "badge": "å…¬é–‹ä¸­",
    "color": "#0ea5e9"
  }
]
```

### 4.2 Proof Frontâ€‘matter (vâ€¯4.4)

```yaml
---
slug: "network-security/packet-capture"
difficulty: easy                    # easy|medium|hard|expert
repro: ["docker"]                 # docker|terraform|vagrant|manual
stack: ["docker","tcpdump"]
updated: 2025-05-01
progress: 100                       # 0â€“100 (æœªå®Œè¡¨ç¤ºç”¨)
tags: ["pcap","wireshark"]
ci_status: "https://â€¦/badge.svg"    # optional
why_md: "./why.md"                 # optional
stories: ["zenn-123"]              # optional
---
```

### 4.3 stories.json (Story)

```jsonc
{
  "id": "zenn-abcdef",
  "source": "zenn",
  "title": "DNSãƒ‘ã‚±ãƒƒãƒˆã‚’èª­ã‚€ã‚³ãƒ„",
  "summary": "tcpdump ã§ DNS ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’â€¦",
  "url": "https://zenn.dev/...",
  "tags": ["network", "pcap"],
  "published": "2025-05-05"
}
```

### 4.4 ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼

* `utils/schema/category.ts`Â : **CategorySchema**
* `utils/schema/proof.ts`Â Â Â Â : **ProofSchema**
* `utils/schema/story.ts`Â Â Â Â : **StorySchema**

CI (`ci.yml`) ã§ `Zod.parse`ã€ã‚¨ãƒ©ãƒ¼ãŒ 1Â ã¤ã§ã‚‚ã‚ã‚Œã°ãƒ–ãƒ­ãƒƒã‚¯ã€‚

---

## 5. ãƒ¬ã‚¤ãƒ¤åˆ¥ Layout ãƒ‘ã‚¿ãƒ¼ãƒ³

| ãƒ¬ã‚¤ãƒ¤       | å…¥å£ãƒšãƒ¼ã‚¸               | è©³ç´°ãƒšãƒ¼ã‚¸                         | ç‰¹å¾´                        |
| --------- | ------------------- | ----------------------------- | ------------------------- |
| Landing   | `/` (`index.astro`) | â€”                             | Hero + CTA                |
| Structure | `/structure/` (ä¸€è¦§)  | `/structure/[slug]/`          | category Card & ProofList |
| Proof     | `/proof/`Â â˜…æ–°è¨­ (ä¸€è¦§)  | `/proof/[category]/[slug]/`   | FilterBar + Pagination    |
| Story     | `/story/` (ä¸€è¦§)      | `/story/tag/[tag]/`Â â˜…vâ€¯1.3 äºˆå®š | RSS åŒæœŸã‚«ãƒ¼ãƒ‰                 |

---

## 6. ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

| ã‚³ãƒãƒ³ãƒ‰                   | å†…å®¹                              |
| ---------------------- | ------------------------------- |
| `pnpm dev`             | é–‹ç™ºã‚µãƒ¼ãƒ (`http://localhost:4321`) |
| `pnpm lint`            | ESLint + Stylelint              |
| `pnpm typecheck`       | `tsc --noEmit` + `astro check`  |
| `pnpm build`           | é™çš„ãƒ“ãƒ«ãƒ‰ (`dist/`)                 |
| `pnpm just up <proof>` | Proof å†ç¾ãƒ©ãƒœ Docker/Vagrant èµ·å‹•    |
| `pnpm mdx2md`          | æ—§ .mdx â†’ .md å¤‰æ› (ç§»è¡ŒæœŸé–“)          |

---

## 7. Git & PR ãƒãƒªã‚·ãƒ¼

| é …ç›®          | è¦ç´„ä¾‹                                                      |
| ----------- | -------------------------------------------------------- |
| ãƒ–ãƒ©ãƒ³ãƒ        | `feat/*`, `fix/*`, `refactor/*`, `ci/*`                  |
| Commit      | Conventionalâ€¯Commits (`feat(proof): add packet-capture`) |
| PRÂ Strategy | **SquashÂ &Â Merge**Â (1Â PRÂ =Â 1Â Commit)                     |
| Issue ãƒ†ãƒ³ãƒ—ãƒ¬  | `/docs/.github/ISSUE_TEMPLATE/`                          |

---

## 8. CI / Quality Gate

### 8.1 Workflow æ¦‚è¦

| workflow           | ãƒˆãƒªã‚¬                      | ä¸»å‡¦ç†                              |
| ------------------ | ------------------------ | -------------------------------- |
| `ci.yml`           | push / PR                | lint â†’ typeâ€‘check â†’ build        |
| `proof-ci.yml`     | pathsâ€‘filter `proofs/**` | ãƒ©ãƒœå†ç¾ (Docker/Vagrant) â†’ Trivy    |
| `sync-stories.yml` | cron (00:15Â JST)         | RSS fetch â†’ stories.json ç”Ÿæˆ â†’ PR |
| `nightly.yml`      | cron (03:00Â JST)         | LighthouseÂ CI / deadâ€‘link / SBOM |

### 8.2 åˆæ ¼åŸºæº–

| æŒ‡æ¨™                 | ç›®æ¨™                   | Failure Action   |
| ------------------ | -------------------- | ---------------- |
| Lint / Type Error  | 0                    | PRÂ Fail          |
| Build Error        | 0                    | PRÂ Fail          |
| Lighthouse Desktop | PerfÂ â‰¥Â 95 / SEOÂ â‰¥Â 90 | Nightly Slack é€šçŸ¥ |
| Trivy Severity     | Critical / High 0Â ä»¶  | PRÂ Fail          |
| deadâ€‘link          | å¤–éƒ¨ URLÂ 404Â =Â 0       | PRÂ Fail          |

---

## 9. è‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ« & ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ãƒ„ãƒ¼ãƒ«               | æ¦‚è¦                                          |
| ----------------- | ------------------------------------------- |
| `rss-to-json.ts`  | Zenn / Note RSS â†’ `stories.json` ç”Ÿæˆ         |
| `mdx2md.ts`       | proof/\*.mdx â†’ .md ç§»è¡Œãƒ˜ãƒ«ãƒ‘                    |
| `gen_onepager.py` | progress.json â†’ PDF Oneâ€‘Pager (CI artifact) |
| `anki-gen`        | Proof / Story ã‹ã‚‰ Anki CSV å‡ºåŠ›                |

---

## 10. ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— 2025 (æ§‹æˆé–¢é€£)

| Quarter | æ³¨åŠ›ãƒ†ãƒ¼ãƒ                              | KPI                  |
| ------- | ---------------------------------- | -------------------- |
| Q2      | Proof vâ€¯1.6 (CopyBlock/Alert å®Œå…¨å®Ÿè£…) | Lighthouse Perf â‰¥Â 95 |
| Q3      | Proofâ€‘CI å¼·åŒ– / Selfâ€‘hostedÂ Runner   | CI å®Ÿè¡Œ â‰¤Â 5â€¯min        |
| Q3      | Story vâ€¯1.3 (ã‚¿ã‚°ä¸€è¦§ï¼‹TagCloud)        | æœˆé–“ 30 è¨˜äº‹åŒæœŸ           |
| Q4      | PWA åŒ– & i18n                       | æœˆé–“ 5kÂ PV             |

---

## 11. FAQ (æ›´æ–°)

| ç—‡çŠ¶                                     | åŸå›                           | è§£æ±ºç­–                                                |
| -------------------------------------- | --------------------------- | -------------------------------------------------- |
| Remark ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è‰²ãŒé©ç”¨ã•ã‚Œãªã„                  | Tailwind safelist ã« HEX æœªç™»éŒ² | `tailwind.config.mjs` è¿½è¨˜ â†’ å†ãƒ“ãƒ«ãƒ‰                    |
| `props is not defined`Â (ProofTemplate) | åˆ†å‰²ä»£å…¥å¾Œã« undefined å‚ç…§         | `const { frontmatter, Content } = Astro.props;` ç¢ºèª |
| FilterBar ã§çµã‚Šè¾¼ã¿ URL ãŒæ›´æ–°ã•ã‚Œãªã„            | `Astro.client:load` å±æ€§ä»˜ã‘å¿˜ã‚Œ  | `<FilterBar client:load />` ã«ä¿®æ­£                    |
| Docker build ãŒ proof-ci ã§è½ã¡ã‚‹           | lab Dockerfile æ›´æ–°å¿˜ã‚Œ         | `pnpm just up <proof>` ãƒ­ãƒ¼ã‚«ãƒ«ç¢ºèª â†’ push               |

---

### **DoneÂ isÂ betterÂ thanÂ perfect â€” andÂ Selfâ€‘DrivingÂ isÂ evenÂ better.**

vâ€¯2.3 ã¯ â€œMarkdownÂ ++â€ & è‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«ã®å°å…¥ã«ã‚ˆã‚Šã€**ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ  â†’ PR â†’ Merge** ã§ã€Œãƒ©ãƒœå…¬é–‹ãƒ»è¨˜äº‹é€£æºãƒ»å“è³ªæ¤œè¨¼ã€ãŒæ»‘ã‚‰ã‹ã«å›ã‚Šç¶šã‘ã‚‹åœŸå°ã‚’æ•´ãˆãŸã€‚ä»Šå¾Œã¯ Proofâ€CI ã¨ Story ã‚¿ã‚° UX ã‚’å¼·åŒ–ã—â€œ24â€¯hÂ Selfâ€‘Driving Portfolioâ€ã‚’å®Œæˆã•ã›ã‚‹ã€‚
